[
  {
    "ruleId": 8,
    "priority": 1,
    "description": "get /parties/{idType}/{idValue}",
    "apiVersion": {
      "minorVersion": 1,
      "majorVersion": 2,
      "type": "mojaloop_connector_outbound",
      "asynchronous": false
    },
    "conditions": {
      "all": [
        {
          "fact": "operationPath",
          "operator": "equal",
          "value": "/parties/{idType}/{idValue}"
        },
        {
          "fact": "method",
          "operator": "equal",
          "value": "get"
        }
      ]
    },
    "event": {
      "method": null,
      "path": null,
      "params": {
        "body": {
          "dateOfBirth": "1966-06-16",
          "displayName": "Chikondi Banda",
          "firstName": "Chikondi",
          "fspId": "testpayee",
          "idType": "MSISDN",
          "idValue": "{$request.params.idValue}",
          "lastName": "Banda",
          "merchantClassificationCode": "1234",
          "middleName": "",
          "kycInformation": "This is encrypted KYC information"
        },
        "statusCode": "200",
        "scripts": {
          "scriptingEngine": "postman"
        }
      },
      "type": "FIXED_RESPONSE"
    },
    "type": "response",
    "version": 1
  },
  {
    "ruleId": 19,
    "priority": 1,
    "description": "Timeout scenario for post /quoterequests",
    "apiVersion": {
      "minorVersion": 1,
      "majorVersion": 2,
      "type": "mojaloop_connector_backend",
      "asynchronous": false,
      "specFile": "/opt/app/spec_files/api_definitions/mojaloop_connector_backend_2.1/api_spec.yaml",
      "callbackMapFile": "/opt/app/spec_files/api_definitions/mojaloop_connector_backend_2.1/callback_map.json",
      "responseMapFile": "/opt/app/spec_files/api_definitions/mojaloop_connector_backend_2.1/response_map.json",
      "jsfRefFile": "/opt/app/spec_files/api_definitions/mojaloop_connector_backend_2.1/mockRef.json",
      "triggerTemplatesFolder": "/opt/app/spec_files/api_definitions/mojaloop_connector_backend_2.1/trigger_templates"
    },
    "conditions": {
      "all": [
        {
          "fact": "body",
          "operator": "equal",
          "value": "scenario-quotes-timeout",
          "path": "from.displayName"
        },
        {
          "fact": "operationPath",
          "operator": "equal",
          "value": "/quoterequests"
        },
        {
          "fact": "method",
          "operator": "equal",
          "value": "post"
        }
      ]
    },
    "event": {
      "method": null,
      "path": null,
      "params": {
        "body": {
          "quoteId": "{$request.body.quoteId}",
          "transactionId": "{$request.body.transactionId}",
          "transferAmount": "{$request.body.amount}",
          "transferAmountCurrency": "{$request.body.currency}",
          "payeeFspFeeAmount": "0",
          "payeeFspFeeAmountCurrency": "{$request.body.currency}",
          "payeeReceiveAmount": "{$request.body.amount}",
          "payeeReceiveAmountCurrency": "{$request.body.currency}"
        },
        "statusCode": "200",
        "scripts": {
          "scriptingEngine": "postman"
        },
        "delay": 300000
      },
      "type": "FIXED_RESPONSE"
    },
    "type": "response",
    "version": 1
  },
  {
    "ruleId": 20,
    "priority": 1,
    "description": "Generic error for post /quoterequests",
    "apiVersion": {
      "minorVersion": 1,
      "majorVersion": 2,
      "type": "mojaloop_connector_backend",
      "asynchronous": false,
      "specFile": "/opt/app/spec_files/api_definitions/mojaloop_connector_backend_2.1/api_spec.yaml",
      "callbackMapFile": "/opt/app/spec_files/api_definitions/mojaloop_connector_backend_2.1/callback_map.json",
      "responseMapFile": "/opt/app/spec_files/api_definitions/mojaloop_connector_backend_2.1/response_map.json",
      "jsfRefFile": "/opt/app/spec_files/api_definitions/mojaloop_connector_backend_2.1/mockRef.json",
      "triggerTemplatesFolder": "/opt/app/spec_files/api_definitions/mojaloop_connector_backend_2.1/trigger_templates"
    },
    "conditions": {
      "all": [
        {
          "fact": "body",
          "operator": "equal",
          "value": "scenario-quotes-generic-error",
          "path": "from.displayName"
        },
        {
          "fact": "operationPath",
          "operator": "equal",
          "value": "/quoterequests"
        },
        {
          "fact": "method",
          "operator": "equal",
          "value": "post"
        }
      ]
    },
    "event": {
      "method": null,
      "path": null,
      "params": {
        "body": {
          "statusCode": "5001",
          "message": "Generic Quotes Error"
        },
        "statusCode": "500",
        "scripts": {
          "scriptingEngine": "postman"
        }
      },
      "type": "FIXED_RESPONSE"
    },
    "type": "response",
    "version": 1
  },
  {
    "ruleId": 9,
    "priority": 1,
    "description": "post /quoterequests",
    "apiVersion": {
      "minorVersion": 1,
      "majorVersion": 2,
      "type": "mojaloop_connector_backend",
      "asynchronous": false
    },
    "conditions": {
      "all": [
        {
          "fact": "operationPath",
          "operator": "equal",
          "value": "/quoterequests"
        },
        {
          "fact": "method",
          "operator": "equal",
          "value": "post"
        }
      ]
    },
    "event": {
      "method": null,
      "path": null,
      "params": {
        "body": {
          "quoteId": "{$request.body.quoteId}",
          "transactionId": "{$request.body.transactionId}",
          "transferAmount": "{$request.body.amount}",
          "transferAmountCurrency": "{$request.body.currency}",
          "payeeFspFeeAmount": "0",
          "payeeFspFeeAmountCurrency": "{$request.body.currency}",
          "payeeReceiveAmount": "{$request.body.amount}",
          "payeeReceiveAmountCurrency": "{$request.body.currency}"
        },
        "statusCode": "200",
        "scripts": {
          "scriptingEngine": "postman"
        }
      },
      "type": "FIXED_RESPONSE"
    },
    "type": "response",
    "version": 1
  },
  {
    "ruleId": 17,
    "priority": 1,
    "description": "Timeout scenario for post /transfers",
    "apiVersion": {
      "minorVersion": 1,
      "majorVersion": 2,
      "type": "mojaloop_connector_backend",
      "asynchronous": false,
      "specFile": "/opt/app/spec_files/api_definitions/mojaloop_connector_backend_2.1/api_spec.yaml",
      "callbackMapFile": "/opt/app/spec_files/api_definitions/mojaloop_connector_backend_2.1/callback_map.json",
      "responseMapFile": "/opt/app/spec_files/api_definitions/mojaloop_connector_backend_2.1/response_map.json",
      "jsfRefFile": "/opt/app/spec_files/api_definitions/mojaloop_connector_backend_2.1/mockRef.json",
      "triggerTemplatesFolder": "/opt/app/spec_files/api_definitions/mojaloop_connector_backend_2.1/trigger_templates"
    },
    "conditions": {
      "all": [
        {
          "fact": "body",
          "operator": "equal",
          "value": "scenario-transfers-timeout",
          "path": "from.displayName"
        },
        {
          "fact": "operationPath",
          "operator": "equal",
          "value": "/transfers"
        },
        {
          "fact": "method",
          "operator": "equal",
          "value": "post"
        }
      ]
    },
    "event": {
      "method": null,
      "path": null,
      "params": {
        "body": {
          "homeTransactionId": "{$request.body.homeTransactionId}",
          "completedTimestamp": "{$environment.completedTimestamp}",
          "conversionState": "RESERVED"
        },
        "statusCode": "200",
        "scripts": {
          "exec": [
            "environment.completedTimestamp = new Date().toISOString()",
            "",
            "const requestBody = JSON.parse(request.body)",
            "",
            "const toPartyId = requestBody.to.idType + '/' + requestBody.to.idValue",
            "",
            "if (!environment.partyData) {",
            "  environment.partyData = {}",
            "}",
            "",
            "if (!environment.partyData[toPartyId]) {",
            "  environment.partyData[toPartyId] = {}",
            "}",
            "",
            "const partyData = environment.partyData[toPartyId]",
            "",
            "if (!partyData.balance) {",
            "  partyData.balance = {}",
            "}",
            "",
            "if (!partyData.balance[requestBody.currency]) {",
            "  partyData.balance[requestBody.currency] = 0",
            "}",
            "",
            "partyData.balance[requestBody.currency] += +requestBody.amount",
            "",
            "",
            "if (!partyData.transactionHistory) {",
            "  partyData.transactionHistory = []",
            "}",
            "const creditDate = new Date(request.headers.date)",
            "const transaction = {",
            "  date: creditDate.getTime(),",
            "  transferId: requestBody.transferId,",
            "  amount: requestBody.amount,",
            "  currency: requestBody.currency,",
            "  from: {",
            "    idType: requestBody.from.idType,",
            "    idValue: requestBody.from.idValue",
            "  }",
            "}",
            "partyData.transactionHistory.push(transaction)",
            "",
            "custom.pushMessage({ transaction: transaction, newBalance: partyData.balance , transactionHistory: partyData.transactionHistory }, toPartyId)"
          ],
          "scriptingEngine": "javascript"
        },
        "delay": 300000
      },
      "type": "FIXED_RESPONSE"
    },
    "type": "response",
    "version": 1
  },
  {
    "ruleId": 18,
    "priority": 1,
    "description": "Generic error for post /transfer",
    "apiVersion": {
      "minorVersion": 1,
      "majorVersion": 2,
      "type": "mojaloop_connector_backend",
      "asynchronous": false,
      "specFile": "/opt/app/spec_files/api_definitions/mojaloop_connector_backend_2.1/api_spec.yaml",
      "callbackMapFile": "/opt/app/spec_files/api_definitions/mojaloop_connector_backend_2.1/callback_map.json",
      "responseMapFile": "/opt/app/spec_files/api_definitions/mojaloop_connector_backend_2.1/response_map.json",
      "jsfRefFile": "/opt/app/spec_files/api_definitions/mojaloop_connector_backend_2.1/mockRef.json",
      "triggerTemplatesFolder": "/opt/app/spec_files/api_definitions/mojaloop_connector_backend_2.1/trigger_templates"
    },
    "conditions": {
      "all": [
        {
          "fact": "body",
          "operator": "equal",
          "value": "scenario-transfers-generic-error",
          "path": "from.displayName"
        },
        {
          "fact": "operationPath",
          "operator": "equal",
          "value": "/transfers"
        },
        {
          "fact": "method",
          "operator": "equal",
          "value": "post"
        }
      ]
    },
    "event": {
      "method": null,
      "path": null,
      "params": {
        "body": {
          "statusCode": "5002",
          "message": "Generic transfer error"
        },
        "statusCode": "500",
        "scripts": {
          "scriptingEngine": "postman"
        }
      },
      "type": "FIXED_RESPONSE"
    },
    "type": "response",
    "version": 1
  },
  {
    "ruleId": 50,
    "priority": 1,
    "description": "ABORTED for post /transfer",
    "apiVersion": {
      "minorVersion": 1,
      "majorVersion": 2,
      "type": "mojaloop_connector_backend",
      "asynchronous": false,
      "specFile": "/opt/app/spec_files/api_definitions/mojaloop_connector_backend_2.1/api_spec.yaml",
      "callbackMapFile": "/opt/app/spec_files/api_definitions/mojaloop_connector_backend_2.1/callback_map.json",
      "responseMapFile": "/opt/app/spec_files/api_definitions/mojaloop_connector_backend_2.1/response_map.json",
      "jsfRefFile": "/opt/app/spec_files/api_definitions/mojaloop_connector_backend_2.1/mockRef.json",
      "triggerTemplatesFolder": "/opt/app/spec_files/api_definitions/mojaloop_connector_backend_2.1/trigger_templates"
    },
    "conditions": {
      "all": [
        {
          "fact": "body",
          "operator": "equal",
          "value": "scenario-transfers-aborted",
          "path": "from.displayName"
        },
        {
          "fact": "operationPath",
          "operator": "equal",
          "value": "/transfers"
        },
        {
          "fact": "method",
          "operator": "equal",
          "value": "post"
        }
      ]
    },
    "event": {
      "method": null,
      "path": null,
      "params": {
        "body": {
          "statusCode": "5100",
          "message": "Generic Payee rejection"
        },
        "statusCode": "500",
        "scripts": {
          "scriptingEngine": "javascript"
        }
      },
      "type": "FIXED_RESPONSE"
    },
    "type": "response",
    "version": 1
  },
  {
    "ruleId": 51,
    "priority": 1,
    "description": "Timeout scenario for post /transfers in merchant payments",
    "apiVersion": {
      "minorVersion": 1,
      "majorVersion": 2,
      "type": "mojaloop_connector_backend",
      "asynchronous": false,
      "specFile": "/opt/app/spec_files/api_definitions/mojaloop_connector_backend_2.1/api_spec.yaml",
      "callbackMapFile": "/opt/app/spec_files/api_definitions/mojaloop_connector_backend_2.1/callback_map.json",
      "responseMapFile": "/opt/app/spec_files/api_definitions/mojaloop_connector_backend_2.1/response_map.json",
      "jsfRefFile": "/opt/app/spec_files/api_definitions/mojaloop_connector_backend_2.1/mockRef.json",
      "triggerTemplatesFolder": "/opt/app/spec_files/api_definitions/mojaloop_connector_backend_2.1/trigger_templates"
    },
    "conditions": {
      "all": [
        {
          "fact": "body",
          "operator": "equal",
          "value": "scenario-transfers-timeout-merchant-payment",
          "path": "from.displayName"
        },
        {
          "fact": "operationPath",
          "operator": "equal",
          "value": "/transfers"
        },
        {
          "fact": "method",
          "operator": "equal",
          "value": "post"
        }
      ]
    },
    "event": {
      "method": null,
      "path": null,
      "params": {
        "body": {
          "homeTransactionId": "{$request.body.homeTransactionId}",
          "completedTimestamp": "{$environment.completedTimestamp}",
          "conversionState": "RESERVED"
        },
        "statusCode": "200",
        "scripts": {
          "exec": [
            "environment.completedTimestamp = new Date().toISOString()",
            "",
            "const requestBody = JSON.parse(request.body)",
            "",
            "const toPartyId = requestBody.to.idType + '/' + requestBody.to.idValue",
            "",
            "if (!environment.partyData) {",
            "  environment.partyData = {}",
            "}",
            "",
            "if (!environment.partyData[toPartyId]) {",
            "  environment.partyData[toPartyId] = {}",
            "}",
            "",
            "const partyData = environment.partyData[toPartyId]",
            "",
            "if (!partyData.balance) {",
            "  partyData.balance = {}",
            "}",
            "",
            "if (!partyData.balance[requestBody.currency]) {",
            "  partyData.balance[requestBody.currency] = 0",
            "}",
            "",
            "partyData.balance[requestBody.currency] += +requestBody.amount",
            "",
            "",
            "if (!partyData.transactionHistory) {",
            "  partyData.transactionHistory = []",
            "}",
            "const creditDate = new Date(request.headers.date)",
            "const transaction = {",
            "  date: creditDate.getTime(),",
            "  transferId: requestBody.transferId,",
            "  amount: requestBody.amount,",
            "  currency: requestBody.currency,",
            "  from: {",
            "    idType: requestBody.from.idType,",
            "    idValue: requestBody.from.idValue",
            "  }",
            "}",
            "partyData.transactionHistory.push(transaction)",
            "",
            "custom.pushMessage({ transaction: transaction, newBalance: partyData.balance , transactionHistory: partyData.transactionHistory }, toPartyId)"
          ],
          "scriptingEngine": "javascript"
        },
        "delay": 300000
      },
      "type": "FIXED_RESPONSE"
    },
    "type": "response",
    "version": 1
  },
  {
    "ruleId": 52,
    "priority": 1,
    "description": "Generic error for post /transfer in merchant payments",
    "apiVersion": {
      "minorVersion": 1,
      "majorVersion": 2,
      "type": "mojaloop_connector_backend",
      "asynchronous": false,
      "specFile": "/opt/app/spec_files/api_definitions/mojaloop_connector_backend_2.1/api_spec.yaml",
      "callbackMapFile": "/opt/app/spec_files/api_definitions/mojaloop_connector_backend_2.1/callback_map.json",
      "responseMapFile": "/opt/app/spec_files/api_definitions/mojaloop_connector_backend_2.1/response_map.json",
      "jsfRefFile": "/opt/app/spec_files/api_definitions/mojaloop_connector_backend_2.1/mockRef.json",
      "triggerTemplatesFolder": "/opt/app/spec_files/api_definitions/mojaloop_connector_backend_2.1/trigger_templates"
    },
    "conditions": {
      "all": [
        {
          "fact": "body",
          "operator": "equal",
          "value": "scenario-transfers-generic-error-merchant-payment",
          "path": "from.displayName"
        },
        {
          "fact": "operationPath",
          "operator": "equal",
          "value": "/transfers"
        },
        {
          "fact": "method",
          "operator": "equal",
          "value": "post"
        }
      ]
    },
    "event": {
      "method": null,
      "path": null,
      "params": {
        "body": {
          "statusCode": "5002",
          "message": "Generic transfer error"
        },
        "statusCode": "500",
        "scripts": {
          "scriptingEngine": "postman"
        }
      },
      "type": "FIXED_RESPONSE"
    },
    "type": "response",
    "version": 1
  },
  {
    "ruleId": 53,
    "priority": 1,
    "description": "ABORTED scenario for post /transfer in merchant payments",
    "apiVersion": {
      "minorVersion": 1,
      "majorVersion": 2,
      "type": "mojaloop_connector_backend",
      "asynchronous": false,
      "specFile": "/opt/app/spec_files/api_definitions/mojaloop_connector_backend_2.1/api_spec.yaml",
      "callbackMapFile": "/opt/app/spec_files/api_definitions/mojaloop_connector_backend_2.1/callback_map.json",
      "responseMapFile": "/opt/app/spec_files/api_definitions/mojaloop_connector_backend_2.1/response_map.json",
      "jsfRefFile": "/opt/app/spec_files/api_definitions/mojaloop_connector_backend_2.1/mockRef.json",
      "triggerTemplatesFolder": "/opt/app/spec_files/api_definitions/mojaloop_connector_backend_2.1/trigger_templates"
    },
    "conditions": {
      "all": [
        {
          "fact": "body",
          "operator": "equal",
          "value": "scenario-transfers-aborted-merchant-payment",
          "path": "from.displayName"
        },
        {
          "fact": "operationPath",
          "operator": "equal",
          "value": "/transfers"
        },
        {
          "fact": "method",
          "operator": "equal",
          "value": "post"
        }
      ]
    },
    "event": {
      "method": null,
      "path": null,
      "params": {
        "body": {
          "statusCode": "5100",
          "message": "Generic Payee rejection"
        },
        "statusCode": "500",
        "scripts": {
          "scriptingEngine": "javascript"
        }
      },
      "type": "FIXED_RESPONSE"
    },
    "type": "response",
    "version": 1
  },
  {
    "ruleId": 71,
    "priority": 1,
    "description": "ABORTED for post /transfer for MSISDNs",
    "apiVersion": {
      "minorVersion": 1,
      "majorVersion": 2,
      "type": "mojaloop_connector_backend",
      "asynchronous": false,
      "specFile": "/opt/app/spec_files/api_definitions/mojaloop_connector_backend_2.1/api_spec.yaml",
      "callbackMapFile": "/opt/app/spec_files/api_definitions/mojaloop_connector_backend_2.1/callback_map.json",
      "responseMapFile": "/opt/app/spec_files/api_definitions/mojaloop_connector_backend_2.1/response_map.json",
      "jsfRefFile": "/opt/app/spec_files/api_definitions/mojaloop_connector_backend_2.1/mockRef.json",
      "triggerTemplatesFolder": "/opt/app/spec_files/api_definitions/mojaloop_connector_backend_2.1/trigger_templates"
    },
    "conditions": {
      "all": [
        {
          "fact": "body",
          "operator": "in",
          "value": "260976652785,265975627283",
          "path": "to.idValue"
        },
        {
          "fact": "operationPath",
          "operator": "equal",
          "value": "/transfers"
        },
        {
          "fact": "method",
          "operator": "equal",
          "value": "post"
        }
      ]
    },
    "event": {
      "method": null,
      "path": null,
      "params": {
        "body": {
          "statusCode": "5100",
          "message": "Generic Payee rejection"
        },
        "statusCode": "500",
        "scripts": {
          "scriptingEngine": "javascript"
        }
      },
      "type": "FIXED_RESPONSE"
    },
    "type": "response",
    "version": 1
  },
  {
    "ruleId": 72,
    "priority": 1,
    "description": "Timeout scenario for post /transfers for MSISDNs",
    "apiVersion": {
      "minorVersion": 1,
      "majorVersion": 2,
      "type": "mojaloop_connector_backend",
      "asynchronous": false,
      "specFile": "/opt/app/spec_files/api_definitions/mojaloop_connector_backend_2.1/api_spec.yaml",
      "callbackMapFile": "/opt/app/spec_files/api_definitions/mojaloop_connector_backend_2.1/callback_map.json",
      "responseMapFile": "/opt/app/spec_files/api_definitions/mojaloop_connector_backend_2.1/response_map.json",
      "jsfRefFile": "/opt/app/spec_files/api_definitions/mojaloop_connector_backend_2.1/mockRef.json",
      "triggerTemplatesFolder": "/opt/app/spec_files/api_definitions/mojaloop_connector_backend_2.1/trigger_templates"
    },
    "conditions": {
      "all": [
        {
          "fact": "body",
          "operator": "in",
          "value": "260976652786,265975627284",
          "path": "to.idValue"
        },
        {
          "fact": "operationPath",
          "operator": "equal",
          "value": "/transfers"
        },
        {
          "fact": "method",
          "operator": "equal",
          "value": "post"
        }
      ]
    },
    "event": {
      "method": null,
      "path": null,
      "params": {
        "body": {
          "homeTransactionId": "{$request.body.homeTransactionId}",
          "completedTimestamp": "{$environment.completedTimestamp}",
          "conversionState": "RESERVED"
        },
        "statusCode": "200",
        "scripts": {
          "exec": [
            "environment.completedTimestamp = new Date().toISOString()",
            "",
            "const requestBody = JSON.parse(request.body)",
            "",
            "const toPartyId = requestBody.to.idType + '/' + requestBody.to.idValue",
            "",
            "if (!environment.partyData) {",
            "  environment.partyData = {}",
            "}",
            "",
            "if (!environment.partyData[toPartyId]) {",
            "  environment.partyData[toPartyId] = {}",
            "}",
            "",
            "const partyData = environment.partyData[toPartyId]",
            "",
            "if (!partyData.balance) {",
            "  partyData.balance = {}",
            "}",
            "",
            "if (!partyData.balance[requestBody.currency]) {",
            "  partyData.balance[requestBody.currency] = 0",
            "}",
            "",
            "partyData.balance[requestBody.currency] += +requestBody.amount",
            "",
            "",
            "if (!partyData.transactionHistory) {",
            "  partyData.transactionHistory = []",
            "}",
            "const creditDate = new Date(request.headers.date)",
            "const transaction = {",
            "  date: creditDate.getTime(),",
            "  transferId: requestBody.transferId,",
            "  amount: requestBody.amount,",
            "  currency: requestBody.currency,",
            "  from: {",
            "    idType: requestBody.from.idType,",
            "    idValue: requestBody.from.idValue",
            "  }",
            "}",
            "partyData.transactionHistory.push(transaction)",
            "",
            "custom.pushMessage({ transaction: transaction, newBalance: partyData.balance , transactionHistory: partyData.transactionHistory }, toPartyId)"
          ],
          "scriptingEngine": "javascript"
        },
        "delay": 300000
      },
      "type": "FIXED_RESPONSE"
    },
    "type": "response",
    "version": 1
  },
  {
    "ruleId": 10,
    "priority": 1,
    "description": "post /transfers",
    "apiVersion": {
      "minorVersion": 1,
      "majorVersion": 2,
      "type": "mojaloop_connector_backend",
      "asynchronous": false
    },
    "conditions": {
      "all": [
        {
          "fact": "operationPath",
          "operator": "equal",
          "value": "/transfers"
        },
        {
          "fact": "method",
          "operator": "equal",
          "value": "post"
        }
      ]
    },
    "event": {
      "method": null,
      "path": null,
      "params": {
        "body": {
          "completedTimestamp": "{$environment.completedTimestamp}",
          "homeTransactionId": "123",
          "transferState": "COMMITTED"
        },
        "statusCode": "200",
        "scripts": {
          "exec": [
            "environment.completedTimestamp = new Date().toISOString()",
            "",
            "const requestBody = JSON.parse(request.body)",
            "",
            "const toPartyId = requestBody.to.idType + '/' + requestBody.to.idValue",
            "",
            "if (!environment.partyData) {",
            "  environment.partyData = {}",
            "}",
            "",
            "if (!environment.partyData[toPartyId]) {",
            "  environment.partyData[toPartyId] = {}",
            "}",
            "",
            "const partyData = environment.partyData[toPartyId]",
            "",
            "if (!partyData.balance) {",
            "  partyData.balance = {}",
            "}",
            "",
            "if (!partyData.balance[requestBody.currency]) {",
            "  partyData.balance[requestBody.currency] = 0",
            "}",
            "",
            "partyData.balance[requestBody.currency] += +requestBody.amount",
            "",
            "",
            "if (!partyData.transactionHistory) {",
            "  partyData.transactionHistory = []",
            "}",
            "const creditDate = new Date(request.headers.date)",
            "const transaction = {",
            "  date: creditDate.getTime(),",
            "  transferId: requestBody.transferId,",
            "  amount: requestBody.amount,",
            "  currency: requestBody.currency,",
            "  from: {",
            "    idType: requestBody.from.idType,",
            "    idValue: requestBody.from.idValue",
            "  }",
            "}",
            "partyData.transactionHistory.push(transaction)",
            "",
            "custom.pushMessage({ transaction: transaction, newBalance: partyData.balance , transactionHistory: partyData.transactionHistory }, toPartyId)"
          ],
          "scriptingEngine": "javascript"
        }
      },
      "type": "FIXED_RESPONSE"
    },
    "type": "response",
    "version": 1
  },
  {
    "ruleId": 11,
    "priority": 1,
    "description": "post /transactionrequests",
    "apiVersion": {
      "minorVersion": 1,
      "majorVersion": 2,
      "type": "mojaloop_connector_backend",
      "asynchronous": true
    },
    "conditions": {
      "all": [
        {
          "fact": "operationPath",
          "operator": "equal",
          "value": "/transactionrequests"
        },
        {
          "fact": "method",
          "operator": "equal",
          "value": "post"
        }
      ]
    },
    "event": {
      "method": null,
      "path": null,
      "params": {
        "body": {
          "homeR2PTransactionId": "cba321",
          "transactionId": "{$function.generic.generateUUID}",
          "transactionRequestState": "RECEIVED"
        },
        "statusCode": "200",
        "scripts": {
          "exec": [
            "const reqBody = JSON.parse(request.body)",
            "const outEndpoint = userConfig.CALLBACK_ENDPOINT",
            "const outReqBody = {",
            "  transactionRequestId: reqBody.transactionRequestId,",
            "  homeR2PTransactionId: 'abc123',",
            "  from: reqBody.to,",
            "  to: reqBody.from,",
            "  amountType: \"RECEIVE\",",
            "  currency: reqBody.currency,",
            "  amount: reqBody.amount,",
            "  scenario: \"DEPOSIT\",",
            "  initiator: reqBody.initiator,",
            "  initiatorType: reqBody.initiatorType,",
            "  note: \"Note sent to Payee.\"",
            "}",
            "try {",
            "  const axioResponse = await axios({",
            "    method: 'post',",
            "    url: outEndpoint + '/requestToPayTransfer',",
            "    data: outReqBody",
            "  });",
            "  res = axioResponse.data;",
            "  responseCode = axioResponse.code || axioResponse.status",
            "} catch (err) {",
            "  console.log(err)",
            "}",
            ""
          ],
          "scriptingEngine": "javascript"
        }
      },
      "type": "MOCK_RESPONSE"
    },
    "type": "response",
    "version": 1
  }
]